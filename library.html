<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>المكتبة الرقمية | منصة تكنولوجيا التعليم</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <link rel="stylesheet" href="style.css" />

    <style>
      /* ستايل مخصص للمكتبة */
      .library-hero {
        background: linear-gradient(45deg, #1e293b, #334155);
        padding: 60px 40px;
        border-radius: 30px;
        margin-bottom: 40px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      .filter-section {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-bottom: 30px;
        justify-content: center;
        background: var(--card-bg);
        padding: 20px;
        border-radius: 20px;
      }
      .filter-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-muted);
        padding: 10px 20px;
        border-radius: 12px;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.9rem;
      }
      .filter-btn.active,
      .filter-btn:hover {
        background: var(--primary-blue);
        color: white;
        border-color: var(--primary-blue);
      }
    </style>
  </head>
  <body>
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loader"></div>
    </div>

    <div class="app-container">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <div class="logo-icon"><i class="fas fa-book-open"></i></div>
          <h2 style="font-size: 1.1rem">تكنولوجيا التعليم</h2>
        </div>
        <nav class="sidebar-nav">
          <ul>
            <li>
              <a href="index.html" class="nav-link"
                ><i class="fas fa-th-large"></i><span>الرئيسية</span></a
              >
            </li>
            <li>
              <a href="index.html#subjects" class="nav-link"
                ><i class="fas fa-book"></i><span>المواد الدراسية</span></a
              >
            </li>
            <li class="active">
              <a href="library.html" class="nav-link"
                ><i class="fas fa-folder-open"></i
                ><span>المكتبة الرقمية</span></a
              >
            </li>
            <li>
              <a href="exams.html" class="nav-link"
                ><i class="fas fa-graduation-cap"></i><span>التقييمات</span></a
              >
            </li>
          </ul>
        </nav>
      </aside>
      <main class="main-wrapper">
        <header class="top-navbar">
          <div class="header-left">
            <button class="menu-btn" id="menuToggle">
              <i class="fas fa-bars"></i>
            </button>
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input
                type="text"
                id="libSearch"
                placeholder="ابحث عن اسم ملزمة محددة..."
              />
            </div>
          </div>
          <div class="header-right">
            <div class="date-chip">
              <i class="fas fa-book-reader"></i> <span>مكتبة التميز</span>
            </div>
          </div>
        </header>

        <div class="content-body">
          <section class="library-hero animate__animated animate__fadeIn">
            <h1>المكتبة الرقمية الشاملة</h1>
            <p>
              هنا تجد جميع الملازم والملفات الخاصة بقسم تكنولوجيا التعليم مرتبة
              ومنظمة
            </p>
          </section>

          <div class="filter-section animate__animated animate__fadeInUp">
            <button
              class="filter-btn active"
              onclick="filterBySubject('all', this)"
            >
              الكل
            </button>
            <button
              class="filter-btn"
              onclick="filterBySubject('tech_edu', this)"
            >
              تكنولوجيا التعليم
            </button>
            <button
              class="filter-btn"
              onclick="filterBySubject('cs_intro', this)"
            >
              علوم الحاسب
            </button>
            <button
              class="filter-btn"
              onclick="filterBySubject('digital_photo', this)"
            >
              التصوير الرقمي
            </button>
            <button
              class="filter-btn"
              onclick="filterBySubject('learning_res', this)"
            >
              مصادر التعلم
            </button>
            <button
              class="filter-btn"
              onclick="filterBySubject('comm_skills', this)"
            >
              مهارات التواصل
            </button>
            <button
              class="filter-btn"
              onclick="filterBySubject('edu_science', this)"
            >
              العلوم التربوية
            </button>
            <button
              class="filter-btn"
              onclick="filterBySubject('curriculum', this)"
            >
              المناهج
            </button>
            <button
              class="filter-btn"
              onclick="filterBySubject('social_issues', this)"
            >
              قضايا مجتمعية
            </button>
          </div>

          <div id="libraryContent" class="quick-grid">
            <div
              class="loader-container"
              style="grid-column: 1/-1; text-align: center; padding: 40px"
            >
              <div class="loader" style="margin: 0 auto"></div>
              <p style="margin-top: 15px; color: var(--text-muted)">
                جاري ترتيب الرفوف الرقمية...
              </p>
            </div>
          </div>
        </div>
      </main>
    </div>
    ``` **لاحظي يا فنانة:** الأزرار هنا واخدة نفس الـ `values` اللي في الـ Admin
    بتاعك (زي `tech_edu`) عشان لما الطالب يدوس "تكنولوجيا التعليم" الجافاسكريبت
    يفهم هو عايز إيه بالظبط. قوليلي **"كملي"** عشان أبعتلك الجزء الثالث اللي فيه
    الربط مع Firebase وعملية البحث والفلترة.
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
      // 1. إعدادات Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyA4_aX-sRYpzZITrt0fF82ONoeb4d71GUA",
        authDomain: "maath-library-2026.firebaseapp.com",
        projectId: "maath-library-2026",
        storageBucket: "maath-library-2026.firebasestorage.app",
        messagingSenderId: "667101666048",
        appId: "1:667101666048:web:220bcfef7157c9b369b1e5",
      };

      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      const db = firebase.firestore();

      let allFiles = []; // مصفوفة لتخزين كل الملفات محلياً للبحث السريع

      // 2. تحميل كل الملفات عند فتح الصفحة
      document.addEventListener("DOMContentLoaded", () => {
        loadAllLibraryData();

        // تفعيل البحث النصي
        document.getElementById("libSearch").addEventListener("input", (e) => {
          const term = e.target.value.toLowerCase();
          filterBySearch(term);
        });
      });

      function loadAllLibraryData() {
        const contentDiv = document.getElementById("libraryContent");

        // جلب ملفات الـ PDF فقط (الملازم)
        db.collection("files")
          .where("type", "==", "files")
          .onSnapshot((snapshot) => {
            allFiles = [];
            snapshot.forEach((doc) => {
              allFiles.push({ id: doc.id, ...doc.data() });
            });
            displayFiles(allFiles); // عرض الكل في البداية

            // إخفاء التحميل
            const loader = document.getElementById("loadingOverlay");
            if (loader) loader.style.display = "none";
          });
      }

      // 3. دالة العرض الأساسية
      function displayFiles(files) {
        const contentDiv = document.getElementById("libraryContent");
        contentDiv.innerHTML = "";

        if (files.length === 0) {
          contentDiv.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 50px;">
                        <i class="fas fa-search" style="font-size: 3rem; color: var(--text-muted); opacity: 0.5;"></i>
                        <p style="margin-top: 15px; color: var(--text-muted);">لم يتم العثور على أي ملفات تطابق اختيارك.</p>
                    </div>`;
          return;
        }

        files.forEach((file) => {
          renderLibraryCard(file, contentDiv);
        });
      } // 4. دالة التصفية حسب المادة
      function filterBySubject(subjectCode, btn) {
        // تحديث شكل الأزرار
        document
          .querySelectorAll(".filter-btn")
          .forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        if (subjectCode === "all") {
          displayFiles(allFiles);
        } else {
          const filtered = allFiles.filter(
            (file) => file.subject === subjectCode
          );
          displayFiles(filtered);
        }
      }

      // 5. دالة البحث النصي (تبحث في الأسماء فوراً)
      function filterBySearch(term) {
        const filtered = allFiles.filter((file) =>
          file.name.toLowerCase().includes(term)
        );
        displayFiles(filtered);
      }

      // 6. تصميم كارت الملف في المكتبة
      function renderLibraryCard(file, container) {
        const card = document.createElement("div");
        card.className = "stat-card animate__animated animate__fadeInUp";

        // قاموس أسماء المواد للعرض فقط
        const subjectNames = {
          tech_edu: "تكنولوجيا التعليم",
          cs_intro: "علوم الحاسب",
          digital_photo: "التصوير الرقمي",
          learning_res: "مصادر التعلم",
          comm_skills: "مهارات التواصل",
          edu_science: "العلوم التربوية",
          curriculum: "المناهج",
          social_issues: "قضايا مجتمعية",
        };

        card.innerHTML = `
                <div class="card-icon" style="background: rgba(59, 130, 246, 0.1); color: #3b82f6;">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div class="card-info">
                    <h3 style="font-size: 1rem; margin-bottom: 5px;">${
                      file.name
                    }</h3>
                    <span style="font-size: 0.75rem; background: #1e293b; padding: 2px 8px; border-radius: 5px; color: var(--text-muted);">
                        ${subjectNames[file.subject] || "عام"}
                    </span>
                    <div style="margin-top: 15px;">
                        <a href="${
                          file.url
                        }" target="_blank" class="btn-card" style="display: block; text-align: center; text-decoration: none;">
                            <i class="fas fa-download"></i> تحميل الملزمة
                        </a>
                    </div>
                </div>
            `;
        container.appendChild(card);
      }

      // 7. تفعيل القائمة الجانبية للموبايل
      const menuToggle = document.getElementById("menuToggle");
      const sidebar = document.getElementById("sidebar");
      if (menuToggle) {
        menuToggle.addEventListener("click", () => {
          sidebar.classList.toggle("active");
        });
      }
    </script>
  </body>
</html>
